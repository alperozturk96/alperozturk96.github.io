<article class="post">
    <header class="post-header">
        <h1>GraphQL & Apollo Client</h1>
        <time datetime="2025-08-24">24 August 2025</time>
    </header>

    <main class="post-content">
        <section class="post-section">
            <p>
                In this blog post, I will walk you through implementing GraphQL on a native iOS client and share tips to make the
                integration easier.
            </p>
        </section>

        <section class="post-section">
            <h2>GraphQL</h2>
            <p>
                GraphQL is an API query language created by Meta that enables clients to retrieve exactly the data they need through a single endpoint.
            </p>

            <p>
                GraphQL operations are categorized into three types:
            </p>

            <ul>
                <li>Query – Used to fetch data (similar to GET).</li>
                <li>Mutation – Used to modify data (CREATE, UPDATE, DELETE).</li>
                <li>Subscription – Enables real-time updates from the server to the client. This allows the client to listen for changes actively.</li>
            </ul>

            <h3>Query</h3>
            <p>
                A query specifies the data you want from the server. You define the operation type, give it a name, and
                select the fields you want returned. One of the major advantages of GraphQL is that you don’t need to overfetch
                data you only retrieve what you request. Moreover, response structures can be auto-generated on the client
                side using tools like Apollo.
            </p>
            <div class="code-container">
                <button class="copy-button" title="Copy">Copy</button>
                <pre><code class="language-graphql">
query QueryCurrentUser {
  currentUser {
    name
    age
  }
}
</code></pre>
            </div>

            <p>
                You can also combine multiple queries into a single request:
            </p>

            <div class="code-container">
                <button class="copy-button" title="Copy">Copy</button>
                <pre><code class="language-graphql">
query QueryCurrentUserAndTransactions {
  currentUser {
    name
    age
  }
  transactions {
    id
    amount
    date
 }
}
</code></pre>
            </div>

            <h3>Mutation</h3>
            <p>
                Mutations allow you to send input data to the server to create, update, or delete resources.
            </p>
            <div class="code-container">
                <button class="copy-button" title="Copy">Copy</button>
                <pre><code class="language-graphql">
mutation CreateUser($name: String!, $age: Int!) {
  createUser(userName: $name, age: $age) {
    name
    age
  }
}
</code></pre>
            </div>

            <h3>Subscription</h3>
            <p>
                Subscriptions allow clients to receive live updates when data changes on the server.
            </p>
            <div class="code-container">
                <button class="copy-button" title="Copy">Copy</button>
                <pre><code class="language-graphql">
subscription {
  newUser {
    name
    age
  }
}
</code></pre>
            </div>

            <h3>Advantages of GraphQL</h3>
            <ul>
                <li>Fetch exactly the data the client needs.</li>
                <li>Combine multiple requests into a single query.</li>
                <li>Single endpoint</li>
                <li>With libraries like Apollo Client, you don’t need to manually write models or response parsing code much of it is generated automatically.</li>
            </ul>
        </section>

        <section class="post-section">
            <h2>Apollo Client</h2>
            <p>
                <span class="external-link">
                    <a href="https://www.apollographql.com/">Apollo Client</a>
                </span>

                is a popular, actively maintained GraphQL library that supports multiple platforms, including iOS,
                Android, and web frameworks like Angular, Vue, and Svelte. It provides tools for schema management,
                code generation, and network handling.
            </p>

            <p>
                Now let's look at iOS implementation.
            </p>

            <h3>Step 1: Download the Schema File</h3>
            <p>
                The schema defines the types and relationships in your GraphQL server. You can download it in JSON or SDL (raw) format.
            </p>

            <p>
                For example, on any public

                <span class="external-link">
                    <a href="https://studio.apollographql.com/public/countries/variant/current/schema/sdl">website</a>
                </span>

                you can download the JSON and RAW formats of your schema from the "Schema" section on the left.
            </p>

            <h3>Step 2: Add Apollo Client & CLI</h3>
            <p>
                Open your Xcode project, right-click on your project, and select "Add Package Dependencies…". After that,
                enter the repository link

                <span class="external-link">
                    <a href="https://github.com/apollographql/apollo-ios">apollo-ios</a>
                </span>

                and add it. Later on just, select Apollo and add it to your target.
            </p>

            <p>
                After successful dependency adding operation right click again to your project and click Install CLI.
            </p>

            <h3>Step 3: Create Apollo Codegen Config</h3>
            <p>
                To be able to get our generated files, we need to create this config JSON file and configure it. Later, we
                will use the CLI together with this config to generate our files.
            </p>

            <p>
                Run the following command in your project root directory:
            </p>

            <p>
                <code>./apollo-ios-cli init --schema-namespace ${MySchemaName} --module-type ${ModuleType}</code>
            </p>

            <p>
                `MySchemaName` will be used as the top-level file name (for example, MySchemaName.GetCurrentUser), so
                choose it according to your needs.
            </p>

            <p>
                I used the following command for my setup, but for more detailed documentation,

                <span class="external-link">
                    <a href="https://www.apollographql.com/docs/ios/get-started#install-the-codegen-cli-1:~:text=Install-,the,-Codegen%20CLI">refer</a>
                </span>

                to the Apollo Client website.
            </p>

            <p>
                <code>./apollo-ios-cli init --schema-namespace CountryAPI --module-type embeddedInTarget --target-name MyDemoApp</code>
            </p>

            <h3>Step 4: Create .graphql File</h3>
            <p>
                Our schema file can contain all potential types and relationships, but our application might not need
                all those operations. Therefore, we don’t need to generate large files. To achieve this, we must create
                client-specific .graphql files.
            </p>

            <p>
                In my example, I hardcoded the country code in the query, but you can also pass it as a parameter. To create
                the file, simply create an empty file in Xcode with the `.graphql` extension and place it wherever you want.
                Make sure to configure it properly in the Apollo Codegen config file so that cli command can find the .graphql file.
            </p>
            <div class="code-container">
                <button class="copy-button" title="Copy">Copy</button>
                <pre><code class="language-graphql">
query CountriesQuery {
  country(code: "TR") {
    name
    native
    emoji
    currency
    languages {
      code
      name
    }
  }
}
</code></pre>
            </div>

            <h3>Step 5: Update Apollo Codegen Config File</h3>
            <p>
                This step can be a bit tricky, as you may encounter various errors related to file paths, missing JSON objects,
                and other issues. Some research might be required. Since I am using a `.json` file as the schema, I had to update
                the `schemaSearchPaths` section.
            </p>
            <div class="code-container">
                <button class="copy-button" title="Copy">Copy</button>
                <pre><code class="language-json">
{
  "schemaNamespace": "CountryAPI",
  "input": {
    "operationSearchPaths": [
      "**/*.graphql"
    ],
    "schemaSearchPaths": [
      "./schema.json"
    ]
  },
  "output": {
    "testMocks": {
      "none": {}
    },
    "schemaTypes": {
      "path": "./CountryAPI",
      "moduleType": {
        "embeddedInTarget": {
          "name": "MyDemoApp"
        }
      }
    },
    "operations": {
      "inSchemaModule": {}
    }
  }
}
</code></pre>
            </div>

            <h3>Step 6: Generate Swift Files</h3>
            <p>
                Run this command:
            </p>

            <p>
                <code>`./apollo-ios-cli generate`</code>
            </p>

            <p>
                This will create a new folder in your project’s root directory if everything goes well.
            </p>

            <h3>Step 7: Import Generated Folder</h3>
            <p>
                After generating the folder, drag and drop it into your Xcode project and add it to your target. Once
                imported, you can use the generated files to implement networking code.
            </p>
            <img class="post-img" src="/src/blog/post/swift/graphQLAndApolloClient/generated_files.png" style="max-width:300px; height:auto;" alt="Generated Files screenshot">

            <h3>iOS Implementation</h3>
            <div class="code-container">
                <button class="copy-button" title="Copy">Copy</button>
                <pre><code class="language-swift">
import Apollo

protocol NetworkProtocol {
    var client: ApolloClient { get }
}

final class Network: NetworkProtocol {
    private(set) lazy var client: ApolloClient = {
        let url = URL(string: "https://countries.trevorblades.com/graphql")!
        return ApolloClient(url: url)
    }()
}

protocol CountryRepository {
    func fetchCountry() async throws -> CountryAPI.CountriesQuery.Data.Country?
}

struct CountryRemoteRepository: CountryRepository {

    private let api: NetworkProtocol

    init(api: NetworkProtocol) {
        self.api = api
    }

    func fetchCountry() async throws -> CountryAPI.CountriesQuery.Data.Country? {
        try await withCheckedThrowingContinuation { continuation in
            api.client.fetch(query: CountryAPI.CountriesQuery()) { result in
                switch result {
                case .success(let response):
                    continuation.resume(returning: response.data?.country)
                case .failure(let error):
                    continuation.resume(throwing: error)
                }
            }
        }
    }
}
</code></pre>
            </div>

            <img class="post-img" src="/src/blog/post/swift/graphQLAndApolloClient/result.png" style="max-width:300px; height:auto;" alt="Result screenshot">
        </section>

        <section class="post-section">
            <h2>Conclusion</h2>
            <p>
                GraphQL offers a flexible and efficient approach, enabling clients to request precisely the data they need in a single query.
            </p>

            <p>
                Apollo Client makes integration on iOS and other platforms easier by
                generating Swift types and handling networking. While setting up Apollo on a native iOS project can be
                error-prone initially nevertheless good to learn and fun to use.
            </p>

            <p>
                You can check this

                <span class="external-link">
                    <a href="https://graphql.org/community/tools-and-libraries/">website</a>
                </span>

                for more tools and libraries.
            </p>
        </section>
    </main>
</article>